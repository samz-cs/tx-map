<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Texas 2024 Results with Demographics</title>
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
<link href="./styles.css" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/intro.js/minified/introjs.min.css">
<script src="https://unpkg.com/intro.js/minified/intro.min.js"></script>
<script src="https://api.mapbox.com/mapbox-gl-js/v3.12.0/mapbox-gl.js"></script>
</head>
<body>
<div id="map"></div>
<!-- Welcome modal -->
<div id="welcomeModal">
  <div class="welcome-card">
    <h3>Welcome</h3>
    <p>Would you like a quick tour of the map features?</p>
    <div class="welcome-actions">
      <button id="welcomeSkip" class="btn secondary">Skip</button>
      <button id="welcomeGuide" class="btn primary">Guide</button>
    </div>
  </div>
 </div>
<div id="leftColumn">
  <div id="summaryBox">
    <div class="collapsible-header" id="summaryHeader">
      <span>Statewide totals</span>
      <button id="summaryToggle" class="collapse-btn" aria-label="Toggle statewide totals">−</button>
    </div>
    <div id="summaryContent">
      <div class="title">Loading...</div>
    </div>
  </div>
  <div id="hoverBox">
    <div class="collapsible-header" id="hoverHeader">
      <span>Hover info</span>
      <button id="hoverToggle" class="collapse-btn" aria-label="Toggle hover info">−</button>
    </div>
    <div id="hoverContent">
      <div class="precinct-title">Hover over a precinct</div>
    </div>
  </div>
</div>
<!-- Color mode box (top-right) -->
<div id="colorModeBox" class="rightBox" style="top:12px;">
  <div style="font-weight:600;">Color mode:
    <label style="margin-left:8px; margin-right:8px;"><input type="radio" name="colormode" value="margin" checked> Dem Margin</label>
    <label><input type="radio" name="colormode" value="shift"> Shift (20→24)</label>
  </div>
</div>

<!-- 3D mode box (below filters) -->
<div id="threeDBox" class="rightBox" style="top: calc(58px + 34vh + 2px + 120px); width: 240px;">
    <div class="collapsible-header" id="threeDHeader">
      <span>3D mode</span>
      <button id="threeDToggle" class="collapse-btn" aria-label="Toggle 3-D mode">−</button>
    </div>
    <div id="threeDContent" style="display:block;">
      <div style="font-weight:600; margin-bottom:6px;">Metric</div>
      <div id="threeDMetrics">
        <label style="display:block; margin-bottom:4px;"><input type="radio" name="metric3d" value="hisp_pct"> Hispanic%</label>
        <label style="display:block; margin-bottom:4px;"><input type="radio" name="metric3d" value="asian_pct"> Asian%</label>
        <label style="display:block; margin-bottom:4px;"><input type="radio" name="metric3d" value="black_pct"> Black%</label>
        <label style="display:block; margin-bottom:4px;"><input type="radio" name="metric3d" value="white_pct"> White%</label>
        <label style="display:block; margin-bottom:4px;"><input type="radio" name="metric3d" value="college_student_pct"> College Student%</label>
        <label style="display:block; margin-bottom:4px;"><input type="radio" name="metric3d" value="college_educated_pct"> College Educated%</label>
        <label style="display:block; margin-bottom:4px;"><input type="radio" name="metric3d" value="shift_20_24"> margin shift (20 → 24)</label>
        <label style="display:block; margin-bottom:4px;"><input type="radio" name="metric3d" value="dem_margin_pct" checked> Dem Margin%</label>
        <label style="display:block; margin-bottom:4px;"><input type="radio" name="metric3d" value="avg_hh_income"> Avg Household Income</label>
      </div>
      <div style="margin-top:8px; display:grid; grid-template-columns:auto 80px auto 80px; gap:8px; align-items:center;">
        <div>Max height (m)</div><input id="threeDMaxHeight" type="number" step="100" value="50000" style="width:72px;"/>
      </div>
      <div style="margin-top:6px; display:grid; grid-template-columns:auto 80px; gap:8px; align-items:center;">
        <div>Min height (m)</div><input id="threeDMinHeight" type="number" step="10" value="0" style="width:72px;"/>
      </div>
      <div style="margin-top:6px; display:grid; grid-template-columns:auto 80px; gap:8px; align-items:center;">
        <div>Contrast (γ)</div><input id="threeDContrast" type="number" step="0.1" min="0.1" value="1.75" style="width:72px;"/>
      </div>
      <div style="margin-top:8px; display:flex; gap:8px;">
        <button id="threeDApply">Apply</button>
        <button id="threeDClear">Clear</button>
      </div>
    </div>
  </div>
</div>

<!-- Filters box (top-right) -->
<div id="filterBox" class="rightBox" style="top:58px; width: 360px;">
    <div class="collapsible-header" id="filterHeader">
      <span>Demographics Filter</span>
      <button id="filterToggle" class="collapse-btn" aria-label="Toggle filters">−</button>
    </div>
    <div id="filterContent" style="display:block;">
    <div style="display:grid; grid-template-columns:auto 48px 24px 80px; gap:6px; align-items:center;">
      <div>Hispanic%</div>
      <select id="f-hisp-op"><option value=">" selected>&gt;</option><option value="<">&lt;</option></select>
      <div></div>
      <input id="f-hisp-val" type="number" min="0" max="100" step="1" placeholder="%"/>

      <div>Asian%</div>
      <select id="f-asian-op"><option value=">" selected>&gt;</option><option value="<">&lt;</option></select>
      <div></div>
      <input id="f-asian-val" type="number" min="0" max="100" step="1" placeholder="%"/>

      <div>Black%</div>
      <select id="f-black-op"><option value=">" selected>&gt;</option><option value="<">&lt;</option></select>
      <div></div>
      <input id="f-black-val" type="number" min="0" max="100" step="1" placeholder="%"/>

      <div>White%</div>
      <select id="f-anglo-op"><option value=">" selected>&gt;</option><option value="<">&lt;</option></select>
      <div></div>
      <input id="f-anglo-val" type="number" min="0" max="100" step="1" placeholder="%"/>

      <div>College Student%</div>
      <select id="f-college-op"><option value=">" selected>&gt;</option><option value="<">&lt;</option></select>
      <div></div>
      <input id="f-college-val" type="number" min="0" max="100" step="1" placeholder="%"/>

      <div>College Educated%</div>
      <select id="f-bach-op"><option value=">" selected>&gt;</option><option value="<">&lt;</option></select>
      <div></div>
      <input id="f-bach-val" type="number" min="0" max="100" step="1" placeholder="%"/>

      <div>margin shift (20 -> 24)</div>
      <select id="f-shift-op"><option value=">" selected>&gt;</option><option value="<">&lt;</option></select>
      <div></div>
      <input id="f-shift-val" type="number" min="-100" max="100" step="1" placeholder="%"/>

      <div>Dem Margin%</div>
      <select id="f-margin-op"><option value=">" selected>&gt;</option><option value="<">&lt;</option></select>
      <div></div>
      <input id="f-margin-val" type="number" min="-100" max="100" step="1" placeholder="%"/>

      <div>Avg Household Income</div>
      <select id="f-avg_hh_income-op"><option value=">" selected>&gt;</option><option value="<">&lt;</option></select>
      <div></div>
      <input id="f-avg_hh_income-val" type="number" step="1000" placeholder="$"/>

      <div>Total votes</div>
      <select id="f-total-op"><option value=">" selected>&gt;</option><option value="<">&lt;</option></select>
      <div></div>
      <input id="f-total-val" type="number" min="0" step="1" placeholder="#"/>

      <div>VAP turnout%</div>
      <select id="f-turnout-op"><option value=">" selected>&gt;</option><option value="<">&lt;</option></select>
      <div></div>
      <input id="f-turnout-val" type="number" min="0" max="100" step="0.1" placeholder="%"/>
    </div>
    <div style="margin-top:6px; display:flex; gap:8px;">
      <button id="applyFilters">Apply</button>
      <button id="clearFilters">Clear</button>
    </div>
    </div>
  </div>
</div>
<div id="zoomBox">
  Zoom: 5.5
</div>

<script src="./config.js"></script>
<script type="module">
  import { init as initMap } from './map_funcs/init.js';
  window.mapboxgl.accessToken = window.APP_CONFIG.MAPBOX_ACCESS_TOKEN;
  initMap(window.mapboxgl);
  console.log("initmap called")
</script>
<script src="./guide.js"></script>

<!-- Floating Guide Button -->
<button id="guideBtn" onclick="startGuide()">Guide</button>

</body>
</html>
